<!DOCTYPE html>
<html>
<head>
  <title>Admin SOS Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <h2>ðŸš¨ Active SOS Alerts</h2>
  <div id="map" style="height:500px;"></div>
  <ul id="alerts"></ul>

  <script>
    let map = L.map('map').setView([20, 78], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    async function loadAlerts() {
      let res = await fetch("http://localhost:5000/sos");
      let alerts = await res.json();

      document.getElementById("alerts").innerHTML = "";
      map.eachLayer((layer) => {
        if (layer instanceof L.Marker) map.removeLayer(layer);
      });

      alerts.forEach(a => {
        let marker = L.marker([a.lat, a.lng]).addTo(map)
          .bindPopup(`<b>${a.name}</b><br>${a.msg}<br>${a.time}`);
        document.getElementById("alerts").innerHTML += 
          `<li>${a.name} - ${a.msg} (${a.time})</li>`;
      });
    }

    setInterval(loadAlerts, 3000); // refresh every 3 sec
  </script>
</body>
</html>
